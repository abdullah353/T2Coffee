var AssessmentListView,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];
}}function c(){this.constructor=d;}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};AssessmentListView=(function(a){__extends(b,a);
function b(){this.newAssessmentSave=__bind(this.newAssessmentSave,this);this.render=__bind(this.render,this);_ref=b.__super__.constructor.apply(this,arguments);
return _ref;}b.prototype.events={"keypress .new_assessment_name":"newAssessmentSave","click .new_assessment_save":"newAssessmentSave","click .new_assessment_cancel":"newAssessmentToggle","click .new_assessment":"newAssessmentToggle","click .import":"import","click .groups":"gotoGroups"};
b.prototype.gotoGroups=function(){return Tangerine.router.navigate("groups",true);};b.prototype["import"]=function(){return Tangerine.router.navigate("import",true);
};b.prototype.initialize=function(c){this.group=c.group;this.curriculaListView=new CurriculaListView({curricula:c.curricula});this.isAdmin=Tangerine.user.isAdmin();
this.views=[];this.publicViews=[];return this.refresh();};b.prototype.refresh=function(){var c,d=this;c=new Assessments;return c.fetch({success:function(f){var e;
e=[];f.each(function(g){if(Tangerine.settings.context==="server"){if(g.get("group")===d.group){return e.push(g);}}else{return e.push(g);}});d.collection=new Assessments(e);
d.collection.on("add remove",d.render);if(Tangerine.settings.context==="server"){d["public"]=new Assessments(f.where({group:"public"}));}else{d["public"]=null;
}return d.render();}});};b.prototype.render=function(){var q,n,s,p,r,l,o,j,h,f,t,u,m,k,i,g,e,d,c,v;this.closeViews();this.views=[];l="<button class='new_assessment command'>New</button>";
r="<button class='import command'>Import</button>";s="<button class='navigation groups'>Groups</button>";p="      "+(Tangerine.settings.context==="server"?s:"")+"      <h1>Assessments</h1>      ";
if(this.isAdmin){p+="        "+(Tangerine.settings.context==="server"?l:"")+"        "+(Tangerine.settings.context==="mobile"?r:"")+"        <div class='new_assessment_form confirmation'>          <div class='menu_box_wide'>            <input type='text' class='new_assessment_name' placeholder='Assessment Name'>            <button class='new_assessment_save command'>Save</button> <button class='new_assessment_cancel command'>Cancel</button>          </div>        </div>        <h2>Group assessments</h2>      ";
}this.$el.html(p);if(((m=this.collection)!=null?(k=m.models)!=null?k.length:void 0:void 0)>0){n=$("<ul>").addClass("assessment_list");g=(i=this.collection)!=null?i.models:void 0;
for(h=0,t=g.length;h<t;h++){q=g[h];o=new AssessmentListElementView({model:q,parent:this});this.views.push(o);o.render();n.append(o.el);}this.$el.append(n);
}else{this.$el.append("<p class='grey'>No assessments yet. Click <b>new</b> to start making one.</p>");}if(this.isAdmin&&Tangerine.settings.context==="server"){this.$el.append("<h2>Public assessments</h2>");
if(((e=this["public"])!=null?(d=e.models)!=null?d.length:void 0:void 0)>0){j=$("<ul>").addClass("public_list assessment_list");v=(c=this["public"])!=null?c.models:void 0;
for(f=0,u=v.length;f<u;f++){q=v[f];o=new AssessmentListElementView({model:q,parent:this,isPublic:true});this.publicViews.push(o);o.render();j.append(o.el);
}}else{this.$el.append("<p>No assessments available.</p>");}this.$el.append(j);if(this.options.curricula.length!==0){this.curriculaListView.render();this.$el.append("<h2>Curricula</h2>");
this.$el.append(this.curriculaListView.el);}}return this.trigger("rendered");};b.prototype.newAssessmentToggle=function(){this.$el.find(".new_assessment_form, .new_assessment").fadeToggle(250);
return false;};b.prototype.newAssessmentSave=function(f){var e,c,d;if(f.type!=="click"&&f.which!==13){return true;}e=this.$el.find(".new_assessment_name").val();
if(e.length!==0){d=Utils.guid();c=new Assessment({name:e,group:this.group,_id:d,assessmentId:d});c.save();this.collection.add(c);Utils.midAlert(""+e+" saved");
}else{Utils.midAlert("<span class='error'>Could not save <img src='images/icon_close.png' class='clear_message'></span>");}return false;};b.prototype.closeViews=function(){var f,g,h,e,c,d;
if(typeof(g=this.curriculaListView).close==="function"){g.close();}c=this.views;d=[];for(h=0,e=c.length;h<e;h++){f=c[h];d.push(f.close());}return d;};b.prototype.onClose=function(){return this.closeViews();
};return b;})(Backbone.View);