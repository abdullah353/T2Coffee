var Assessment,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];
}}function c(){this.constructor=d;}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};Assessment=(function(b){__extends(a,b);
function a(){this.updateFromServer=__bind(this.updateFromServer,this);this.fetch=__bind(this.fetch,this);_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.url="assessment";a.prototype.initialize=function(c){if(c==null){c={};}return this.subtests=new Subtests;};a.prototype.fetch=function(c){var d,e=this;
d=c.success;c.success=function(f){var g;g=new Subtests;return g.fetch({key:e.id,success:function(h){e.subtests=h;e.subtests.maintainOrder();return typeof d==="function"?d(e):void 0;
}});};return a.__super__.fetch.call(this,c);};a.prototype.updateFromServer=function(c){var d,e=this;if(c==null){c=this.id.substr(-5,5);}this.trigger("status","import lookup");
d=JSON.stringify(c.replace(/[^a-f0-9]/g," ").split(/\s+/));$.ajax(""+Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+"/"+Tangerine.db_name+"/_design/"+Tangerine.design_doc+"/_view/byDKey",{type:"POST",dataType:"jsonp",data:{keys:d},success:function(k){var i,h,j,g,f;
h=[];f=k.rows;for(j=0,g=f.length;j<g;j++){i=f[j];h.push(i.id);}if(k.rows.length===0){e.trigger("status","import empty");}if(k.rows.length!==0){return $.couch.replicate(Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,{success:function(){return e.trigger("status","import success");
},error:function(m,l){return e.trigger("status","import error",""+m+" "+l);}},{doc_ids:h});}}});return false;};a.prototype.duplicate=function(h,k,g,j){var d,i,c,e,f=this;
c=this.id;i=this.clone();i.set(h);d=Utils.guid();i.set({_id:d,assessmentId:d});i.save(null,{wait:true});e=new Questions;return e.fetch({key:this.id,success:function(l){var m;
m=new Subtests;return m.fetch({key:c,success:function(x){var v,z,B,t,s,y,u,q,C,A,w,D,p,o,n,E,G,F,r;v=x.models;D={};C=[];for(B=p=0,E=v.length;p<E;B=++p){t=v[B];
u=t.clone();u.set("assessmentId",i.id);q=Utils.guid();D[u.id]=q;u.set("_id",q);C.push(u);}for(B=o=0,G=C.length;o<G;B=++o){t=C[B];z=t.get("gridLinkId");
if((z||"")!==""){t.set("gridLinkId",D[z]);}t.save();}y=[];r=l.models;for(n=0,F=r.length;n<F;n++){w=r[n];s=w.clone();A=s.get("subtestId");s.set("assessmentId",i.id);
s.set("_id",Utils.guid());s.set("subtestId",D[A]);y.push(s);s.save();}return j();}});}});};a.prototype.destroy=function(){var c,d,e;c=this.id;e=new Subtests;
e.fetch({key:c,success:function(g){var f;f=[];while(g.length!==0){f.push(g.pop().destroy());}return f;}});d=new Questions;d.fetch({key:this.id,success:function(g){var f;
f=[];while(g.length!==0){f.push(g.pop().destroy());}return f;}});return a.__super__.destroy.call(this);};return a;})(Backbone.Model);