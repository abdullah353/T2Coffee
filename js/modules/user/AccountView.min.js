var AccountView,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};AccountView=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.events={"click .leave":"leaveGroup","click .join_cancel":"joinToggle","click .join":"joinToggle","click .join_group":"join","click .config":"config","click .back":"goBack","click #mode_buttons input":"changeMode"};
a.prototype.changeMode=function(d){var c,e=this;c=new Settings({_id:"TangerineSettings"});return c.fetch({success:function(f){f.set({context:$(d.target).val()});
return f.save();}});};a.prototype.goBack=function(){return window.history.back();};a.prototype.joinToggle=function(){this.$el.find(".join, .join_confirmation").fadeToggle(0);
return this.$el.find("#group_name").val("");};a.prototype.join=function(){var c;c=this.$el.find("#group_name").val().replace(/\s|-/g,"_").replace(/[^a-zA-Z0-9_'"]/g,"");
if(c.length===0){return;}this.user.joinGroup(c);this.joinToggle();return this.render();};a.prototype.leaveGroup=function(c){var d;d=$(c.target).parent().attr("data-group");
this.user.leaveGroup(d);return this.render();};a.prototype.initialize=function(c){this.user=c.user;this.role=this.user.roles.join();if(this.role==="_admin"){return this.visible="block";
}else{return this.visible="none";}};a.prototype.render=function(){var e,h,f,i,g,d,c;this.config="";f="      <button class='back navigation'>Back</button>      <div style='display:"+this.visible+"'>        <h1>Server Configuration</h1>        <p><strong>Current Server is : "+Tangerine.config.address.cloud.host+"</strong> </p>        <select class='serverurl space15'>          <option value='http://tangerine.iriscouch.com'>Tangerine Server</option>          <option value='http://m.teletaaleem.com'>Teletaleem Server</option>        </select><button class='config navigation' >Update Server</button>      </div>      <div class='groupdiv'>      <h1>Account</h1>      <div class='label_value'>        <label>Name</label>        <p>"+this.user.name+"</p>      </div>      <div class='label_value menu_box'>        <label>Groups</label>        <ul>    ";
c=this.user.get("groups")||[];for(g=0,d=c.length;g<d;g++){h=c[g];f+="<li data-group='"+(_.escape(h))+"'>"+h+" <button class='command leave'>Leave</button></li>";
}i=Tangerine.settings.context==="mobile"?" checked='checked'":"";e=Tangerine.settings.context==="class"?" checked='checked'":"";f+="        </ul>        <button class='command join'>Join or create a group</button>        <div class='confirmation join_confirmation'>          <input id='group_name' placeholder='Group name'>          <small>Please be specific.<br>          Good examples: MalawiJun2012, MikeTestGroup2012, EGRAGroup2012<br>          Bad examples: group, test, mine</small><br>          <button class='command join_group'>Join Group</button>          <button class='command join_cancel'>Cancel</button>        </div>      </div><br>      <!--button class='command confirmation'>Report a bug</button>      <div class='confirmation' id='bug'>        <label for='where'>What broke?        <input id='where' placeholder='where'>        <label for='where'>What happened?        <input id='where' placeholder='what'>        <label for='where'>What should have happened?        <input id='should' placeholder='should'>        <button>Send</button>      </div-->      </div>      ";
this.$el.html(f);return this.trigger("rendered");};a.prototype.config=function(){var c=this;if(($(".serverurl").val()!=null)&&$(".serverurl").val()!==""){Tangerine.config.address.cloud.host=$(".serverurl").val();
return Tangerine.$db.saveDoc(Tangerine.config,{success:function(d){return c.render();}});}};return a;})(Backbone.View);