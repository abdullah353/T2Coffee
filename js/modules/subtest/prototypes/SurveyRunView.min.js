var ResultOfQuestion,SurveyRunView,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];
}}function c(){this.constructor=d;}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};ResultOfQuestion=function(a){return $("#question-"+a).attr("data-result");
};SurveyRunView=(function(a){__extends(b,a);function b(){this.onQuestionRendered=__bind(this.onQuestionRendered,this);this.getResult=__bind(this.getResult,this);
this.updateSkipLogic=__bind(this.updateSkipLogic,this);this.onQuestionAnswer=__bind(this.onQuestionAnswer,this);_ref=b.__super__.constructor.apply(this,arguments);
return _ref;}b.prototype.events={"change input":"updateSkipLogic","change textarea":"updateSkipLogic"};b.prototype.initialize=function(c){var d=this;this.model=this.options.model;
this.parent=this.options.parent;this.isObservation=this.options.isObservation;this.questionViews=[];this.answered=[];this.questions=new Questions;return this.questions.fetch({key:this.model.get("assessmentId"),success:function(e){d.questions=new Questions(d.questions.where({subtestId:d.model.id}));
d.questions.sort();return d.render();}});};b.prototype.onQuestionAnswer=function(h){var j,g,f,i,e,c,d;if(this.isObservation){j=$(h.target).attr("data-cid");
c=this.questionViews;d=[];for(i=0,e=c.length;i<e;i++){f=c[i];if(f.cid===j&&f.type!=="multiple"){g=$(f.el).next();while(g.length!==0&&g.hasClass("disabled_skipped")){g=$(g).next();
}if(g.length!==0){d.push(g.scrollTo());}else{d.push(void 0);}}else{d.push(void 0);}}return d;}};b.prototype.updateSkipLogic=function(){this.questions.each(function(d){var c,e;
e=d.get("skipLogic");if(e!=null){c=CoffeeScript["eval"](""+e);if(c){return $("#question-"+(d.get("name"))).addClass("disabled_skipped");}else{return $("#question-"+(d.get("name"))).removeClass("disabled_skipped");
}}});return _.each(this.questionViews,function(c){return c.updateValidity();});};b.prototype.isValid=function(){var e,g,f,d,c;c=this.questionViews;for(e=f=0,d=c.length;
f<d;e=++f){g=c[e];g.updateValidity();if(g.isValid!=null){if(!(g.model.get("skippable")==="true"||g.model.get("skippable")===true)){if(!g.isValid){return false;
}}}}return true;};b.prototype.getSkipped=function(){var f,h,d,g,e,c;d={};c=this.questionViews;for(f=g=0,e=c.length;g<e;f=++g){h=c[f];d[this.questions.models[f].get("name")]="skipped";
}return d;};b.prototype.getResult=function(){var f,h,d,g,e,c;d={};c=this.questionViews;for(f=g=0,e=c.length;g<e;f=++g){h=c[f];d[this.questions.models[f].get("name")]=h.notAsked?h.notAskedResult:!_.isEmpty(h.answer)?h.answer:h.skipped?h.skippedResult:h.$el.hasClass("disabled_skipped")?h.logicSkippedResult:h.answer;
}return d;};b.prototype.getSum=function(){var f,e,h,g,d,c;f={correct:0,incorrect:0,missing:0,total:0};c=this.questionViews;for(e=g=0,d=c.length;g<d;e=++g){h=c[e];
if(_.isString(h)){f.missing++;}else{if(h.isValid){f.correct+=1;}if(!h.isValid){f.incorrect+=1;}if(!h.isValid&&(h.model.get("skippable"==="true"||h.model.get("skippable"===true)))){f.missing+=1;
}if(true){f.total+=1;}}}return{correct:f.correct,incorrect:f.incorrect,missing:f.missing,total:f.total};};b.prototype.showErrors=function(){var k,f,g,j,h,e,c,d;
this.$el.find(".message").remove();k=true;c=this.questionViews;d=[];for(f=h=0,e=c.length;h<e;f=++h){j=c[f];if(!_.isString(j)){g="";if(!j.isValid){g="Please answer this question";
if(k===true){j.$el.scrollTo();Utils.midAlert("Please correct the errors on this page");k=false;}}d.push(j.setMessage(g));}else{d.push(void 0);}}return d;
};b.prototype.render=function(){var g,l,h,c,e,j,m,f,k,d;h=0;this.questions.sort();if(this.questions.models!=null){d=this.questions.models;for(g=f=0,k=d.length;
f<k;g=++f){e=d[g];j=parseInt(e.get("linkedGridScore"))||0;l=(j!==0&&this.parent.getGridScore()<j)||this.parent.gridWasAutostopped();if(l){h++;}c=new QuestionRunView({model:e,parent:this,notAsked:l,isObservation:this.isObservation});
c.on("rendered",this.onQuestionRendered);c.on("answer scroll",this.onQuestionAnswer);c.render();this.questionViews[g]=c;this.$el.append(c.el);}}this.updateSkipLogic();
if(this.questions.length===h){if(typeof(m=this.parent).next==="function"){m.next();}}return this.trigger("rendered");};b.prototype.onQuestionRendered=function(){return this.trigger("subRendered");
};b.prototype.onClose=function(){var f,e,d,c;c=this.questionViews;for(e=0,d=c.length;e<d;e++){f=c[e];if(typeof f.close==="function"){f.close();}}return this.questionViews=[];
};return b;})(Backbone.View);