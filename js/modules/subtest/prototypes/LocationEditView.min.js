var LocationEditView,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;},__indexOf=[].indexOf||function(c){for(var b=0,a=this.length;b<a;b++){if(b in this&&this[b]===c){return b;
}}return -1;};LocationEditView=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);return _ref;}a.prototype.events={"keyup #data":"updateData","keyup #levels":"updateLevels","click #data_format input":"updateData","click #levels_format input":"updateLevels"};
a.prototype.updateData=function(d){var e,c,f;if((d!=null?d.type:void 0)==="click"){if($(d.target).val()==="Tabs"){this.dataCommaToTab();f=true;c=false;
}else{this.dataTabToComma();f=false;c=true;}}else{e=this.$el.find("#data").val();f=e.match(/\t/g)!=null;c=e.match(/,/g)!=null;}if(f){this.$el.find("#data_format :radio[value='Tabs']").attr("checked","checked");
return this.$el.find("#data_format").buttonset("refresh");}else{this.$el.find("#data_format :radio[value='Commas']").attr("checked","checked");return this.$el.find("#data_format").buttonset("refresh");
}};a.prototype.updateLevels=function(d){var c,f,e;if((d!=null?d.type:void 0)==="click"){if($(d.target).val()==="Tabs"){this.levelsCommaToTab();f=true;c=false;
}else{this.levelsTabToComma();f=false;c=true;}}else{e=this.$el.find("#levels").val();f=e.match(/\t/g)!=null;c=e.match(/,/g)!=null;}e=this.$el.find("#levels").val();
f=e.match(/\t/g)!=null;c=e.match(/,/g)!=null;if(f){this.$el.find("#levels_format :radio[value='Tabs']").attr("checked","checked");return this.$el.find("#levels_format").buttonset("refresh");
}else{this.$el.find("#levels_format :radio[value='Commas']").attr("checked","checked");return this.$el.find("#levels_format").buttonset("refresh");}};a.prototype.dataTabToComma=function(){return this.$el.find("#data").val(String(this.$el.find("#data").val()).replace(/\t/g,", "));
};a.prototype.dataCommaToTab=function(){return this.$el.find("#data").val(this.$el.find("#data").val().replace(/, */g,"\t"));};a.prototype.levelsTabToComma=function(){return this.$el.find("#levels").val(String(this.$el.find("#levels").val()).replace(/\t/g,", "));
};a.prototype.levelsCommaToTab=function(){return this.$el.find("#levels").val(this.$el.find("#levels").val().replace(/, */g,"\t"));};a.prototype.save=function(){var h,d,m,l,j,c,g,f,k,e;
if(this.$el.find("#data").val().match(/\t/g)!=null){this.$el.find("#data_format :radio[value='Tabs']").attr("checked","checked");this.$el.find("#data_format").buttonset("refresh");
this.dataTabToComma();}if(this.$el.find("#levels").val().match(/\t/g)!=null){this.levelsTabToComma();this.$el.find("#levels_format :radio[value='Tabs']").attr("checked","checked");
this.$el.find("#levels_format").buttonset("refresh");}m=this.$el.find("#levels").val().split(/, */g);for(h=g=0,k=m.length;g<k;h=++g){d=m[h];m[h]=$.trim(d).replace(/[^a-zA-Z0-9']/g,"");
}c=$.trim(this.$el.find("#data").val());j=c.split("\n");for(h=f=0,e=j.length;f<e;h=++f){l=j[h];j[h]=l.split(/, */g);}return this.model.set({levels:m,locations:j});
};a.prototype.isValid=function(){var g,e,f,d,c;g=this.model.get("levels");c=this.model.get("locations");for(f=0,d=c.length;f<d;f++){e=c[f];if(e.length!==g.length){if(__indexOf.call(this.errors,"column_match")<0){this.errors.push("column_match");
}}}return this.errors.length===0;};a.prototype.showErrors=function(){var g,e,f,d,c;g="Please correct the following errors:\n\n";c=this.errors;for(f=0,d=c.length;
f<d;f++){e=c[f];g+=this.errorMessages[e];}alert(g);return this.errors=[];};a.prototype.initialize=function(c){this.errors=[];this.model=c.model;return this.errorMessages={column_match:"Some columns in the location data do not match the number of columns in the geographic levels."};
};a.prototype.render=function(){var f,h,e,c,g,d;h=this.model.get("levels")||[];c=this.model.get("locations")||[];h=h.join(", ");c=c.join("\n");if(_.isArray(c)){for(f=g=0,d=c.length;
g<d;f=++g){e=c[f];c[f]=e.join(", ");}}this.$el.html("      <div class='label_value'>        <div class='menu_box'>          <label for='levels' title='This is a comma separated list of geographic levels. (E.g. Country, Province, District, School Id) These are the levels that you would consider individual fields on the location form.'>Geographic Levels</label>          <input id='levels' value='"+h+"'>          <label title='Tangerine uses comma separated values. If you copy and paste from another program like Excel, the values will be tab separated. These buttons allow you to switch back and forth, however, Tangerine will always save the comma version.'>Format</label><br>          <div id='levels_format' class='buttonset'>            <label for='levels_tabs'>Tabs</label>            <input id='levels_tabs' name='levels_format' type='radio' value='Tabs'>            <label for='levels_commas'>Commas</label>            <input id='levels_commas' name='levels_format' type='radio' value='Commas'>          </div>        </div>      </div>      <div class='label_value'>        <div class='menu_box'>          <label for='data' title='Comma sperated values, with multiple rows separated by line. This information will be used to autofill the location data.'>Location data</label>          <textarea id='data'>"+c+"</textarea><br>          <label title='Tangerine uses comma separated values. If you copy and paste from another program like Excel, the values will be tab separated. These buttons allow you to switch back and forth, however, Tangerine will always save the comma version.'>Format</label><br>        <div id='data_format' class='buttonset'>            <label for='data_tabs'>Tabs</label>            <input id='data_tabs' name='data_format' type='radio' value='Tabs'>            <label for='data_commas'>Commas</label>            <input id='data_commas' name='data_format' type='radio' value='Commas'>        </div>              </div>    ");
this.updateLevels();return this.updateData();};return a;})(Backbone.View);