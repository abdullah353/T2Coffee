var LocationRunView,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};LocationRunView=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.events={"click .school_list li":"autofill","click .school_list li.licomp":"licomp","click .school_list li.lipend":"lipend","keyup input.search":"showOptions","click .clear":"clearInputs"};
a.prototype.initialize=function(t){var l,p,m,d,r,n,s,k,j,g,q,e,c,h,f,o=this;this.pendResAr=[];this.compResAr=[];this.penNam=[];this.penkeys=[];this.compNam=[];
this.samAssessmentId=t.parent.model.attributes.assessmentId;this.resultarray=new Results;this.resultarray.fetch({key:this.samAssessmentId,success:function(i){_.each(i.models,function(v){var w,u;
if(((u=_.last(v.attributes.subtestData))!=null?u.data.end_time:void 0)!=null){return o.compResAr.push(v.attributes.subtestData);}else{o.pendResAr.push(v.attributes.subtestData);
if(o.penkeys.length===0){o.penkeys.push(v.id);}w=false;_.each(o.penkeys,function(x){if(x!==v.id){return w=true;}});if(w){return o.penkeys.push(v.id);}}});
_.each(o.pendResAr,function(u){return _.each(u,function(w){var v;if(((w!=null?w.prototype:void 0)!=null)&&w.prototype==="location"&&(((v=w.data)!=null?v.location:void 0)!=null)){return o.penNam.push(w.data.location);
}});});return _.each(o.compResAr,function(u){return _.each(u,function(w){var v;if(((w!=null?w.prototype:void 0)!=null)&&w.prototype==="location"&&(((v=w.data)!=null?v.location:void 0)!=null)){return o.compNam.push(w.data.location);
}});});}});this.model=this.options.model;this.parent=this.options.parent;this.levels=this.model.get("levels")||[];this.locations=this.model.get("locations")||[];
if(this.levels.length===1&&this.levels[0]===""){this.levels=[];}if(this.locations.length===1&&this.locations[0]===""){this.locations=[];}this.haystack=[];
this.locations=this.locations.sort();h=this.locations;for(m=k=0,q=h.length;k<q;m=++k){r=h[m];this.haystack[m]=[];for(j=0,e=r.length;j<e;j++){n=r[j];this.haystack[m].push(n.toLowerCase());
}}s="<li class='cont' data-index='{{i}}'>";f=this.levels;for(m=g=0,c=f.length;g<c;m=++g){d=f[m];s+="{{level_"+m+"}}";if(m!==this.levels.length-1){s+=" - ";
}}s+="</li>";this.li=_.template(s);l='<button class="restart-btn navigation">Restart</button>';this.btnreset=_.template(l);p='<button class="resume-btn navigation">Resume</button>';
return this.btnresume=_.template(p);};a.prototype.clearInputs=function(){var f,h,g,e,c,d;this.clearMessage();this.clearButton();$("#samSearchBox").val("");
$(".tohide").hide();c=this.levels;d=[];for(f=g=0,e=c.length;g<e;f=++g){h=c[f];d.push(this.$el.find("#level_"+f).val(""));}return d;};a.prototype.autofill=function(d){var h,j,c,l,g,k,f,e;
this.clearMessage();this.clearButton();$(".tohide").show();this.$el.find(".autofill").fadeOut(250);j=$(d.target).attr("data-index");l=this.locations[j];
f=this.levels;e=[];for(h=g=0,k=f.length;g<k;h=++g){c=f[h];e.push(this.$el.find("#level_"+h).val(l[h]));}return e;};a.prototype.showOptions=function(u){var q,f,p,v,s,t,w,B,o,r,n,k,g,e,d,y,A,z,x,c,m,l,h;
this.clearMessage();w=$(u.target).val().toLowerCase();if(w===""){return $(".autofill").hide();}else{f=parseInt($(u.target).attr("data-level"));for(B=k=0,m=this.haystack.length;
0<=m?k<=m:k>=m;B=0<=m?++k:--k){this.$el.find("#autofill_"+B).hide();}q=false;r=[];l=this.haystack;for(v=g=0,y=l.length;g<y;v=++g){n=l[v];s=this.haystack[v][f].search(new RegExp("^"+w,"i"));
if(s===0){r.push(v);q=true;}}h=this.haystack;for(v=e=0,A=h.length;e<A;v=++e){n=h[v];for(t=d=0,z=n.length;d<z;t=++d){B=n[t];if(t===f){continue;}s=~this.haystack[v][t].indexOf(w);
if(s&&!~r.indexOf(v)){r.push(v);}if(s){q=true;}}}if(q){p="";for(c=0,x=r.length;c<x;c++){o=r[c];p+=this.getLocationLi(o);}this.$el.find("#autofill_"+f).fadeIn(250);
return this.$el.find("#school_list_"+f).html(p);}else{return this.$el.find("#autofill_"+f).fadeOut(250);}}};a.prototype.getLocationLi=function(h){var m,g,e,o,c,f,n,d,l=this;
c={i:h};d=this.locations[h];for(g=f=0,n=d.length;f<n;g=++f){o=d[g];c["level_"+g]=o;m=this.li(c);e=false;_.each(this.penNam,function(p,k){var j;j=[];j.push(o);
if(_.isEqual(j,p)){m=m.replace("<li class='cont'","<li class='lipend' style='color:red;' data-key='"+l.penkeys[k]+"' ");}if(_.isEqual(j,p)){return e=true;
}});if(e===true){m=m.replace("</li>"," (Incomplete) </li>");}e=false;_.each(this.compNam,function(i){var j;j=[];j.push(o);if(_.isEqual(j,i)){return m=m.replace("<li class='cont'","<li class='licomp' style='color:green;'");
}});}return m;};a.prototype.render=function(){var k,j,c,l,h,g,m,d,f,e;l="";f=this.levels;for(j=h=0,m=f.length;h<m;j=++h){c=f[j];k="<input class='search' val='' data-level='"+j+"' id='samSearchBox' placeholder='Search For Student Name'>";
}k+="      <button class='clear command'>Clear</button>      ";e=this.levels;for(j=g=0,d=e.length;g<d;j=++g){c=e[j];k+="        <div class='label_value tohide' style='display:none'>          <label>Selected Student Name: </label>          <input class='name-field' data-level='"+j+"' id='level_"+j+"' value='' disabled style='background:white;border:0px;width: 70%;color:#476F00 !important;font-weight: bold;'>        </div>        <div id='autofill_"+j+"' class='autofill' style='display:none'>          <h2>Select one from autofill list</h2>          <ul class='school_list' id='school_list_"+j+"'>          </ul>        </div>    ";
}this.$el.html(k);return this.trigger("rendered");};a.prototype.getResult=function(){var c,d;return{labels:(function(){var h,g,e,f;e=this.levels;f=[];for(h=0,g=e.length;
h<g;h++){d=e[h];f.push(d.replace(/[\s-]/g,"_"));}return f;}).call(this),location:(function(){var h,g,e,f;e=this.levels;f=[];for(c=h=0,g=e.length;h<g;c=++h){d=e[c];
f.push($.trim(this.$el.find("#level_"+c).val()));}return f;}).call(this)};};a.prototype.getSkipped=function(){var c,d;return{labels:(function(){var h,g,e,f;
e=this.levels;f=[];for(h=0,g=e.length;h<g;h++){d=e[h];f.push(d.replace(/[\s-]/g,"_"));}return f;}).call(this),location:(function(){var h,g,e,f;e=this.levels;
f=[];for(c=h=0,g=e.length;h<g;c=++h){d=e[c];f.push("skipped");}return f;}).call(this)};};a.prototype.isValid=function(){var e,f,d,c;this.$el.find(".message").remove();
c=this.$el.find("input");for(f=0,d=c.length;f<d;f++){e=c[f];if($(e).val()===""){return false;}}return true;};a.prototype.showErrors=function(){var f,g,e,c,d;
c=this.$el.find("input.name-field");d=[];for(g=0,e=c.length;g<e;g++){f=c[g];if($(f).val()===""){d.push($(f).parent().after(" <span class='message' style='color:red;clear:both;display:block;'>Please select a student to proceed.</span>"));
}else{d.push(void 0);}}return d;};a.prototype.getSum=function(){var h,f,e,g,d,c;f={correct:0,incorrect:0,missing:0,total:0};c=this.$el.find("input");for(g=0,d=c.length;
g<d;g++){e=c[g];h=$(e);if((h.val()||"")!==""){f.correct+=1;}if(false){f.incorrect+=0;}if((h.val()||"")===""){f.missing+=1;}if(true){f.total+=1;}}return{correct:f.correct,incorrect:f.incorrect,missing:f.missing,total:f.total};
};a.prototype.licomp=function(c){$("button.next").hide();if($("button.restart-btn").length===0){$("div.controlls").append(this.btnreset);}else{$("button.restart-btn").show();
}return $("button.restart-btn").unbind("click").click(function(){if(confirm("Are you sure you want to restart this assessment?")){return $("button.next").trigger("click");
}});};a.prototype.lipend=function(f){var d,e,c,j,h,g,i=this;if((f!=null?(c=f.currentTarget)!=null?(j=c.dataset)!=null?j.key:void 0:void 0:void 0)!=null){e=f.currentTarget.dataset.key;
}if((f!=null?(h=f.currentTarget)!=null?(g=h.dataset)!=null?g.index:void 0:void 0:void 0)!=null){d=f.currentTarget.dataset.index;}this.licomp();if($("button.resume-btn").length===0){$("div.controlls").append(this.btnresume);
}else{$("button.resume-btn").show();}return $("button.resume-btn").unbind("click").click(function(){return Tangerine.router.navigate("resume/"+i.samAssessmentId+"/"+e,true);
});};a.prototype.clearButton=function(){$("button.restart-btn").hide();$("button.resume-btn").hide();return $("button.next").show();};a.prototype.clearMessage=function(){return $("span.message").hide();
};return a;})(Backbone.View);