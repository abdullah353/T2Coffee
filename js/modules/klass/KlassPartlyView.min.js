var KlassPartlyView,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};KlassPartlyView=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.events={"click .next_part":"nextPart","click .prev_part":"prevPart","click .back":"back","click .student_subtest":"gotoStudentSubtest","keyup #current_part":"gotoAssessment","keyup #search_student_name":"filterStudents"};
a.prototype.filterStudents=function(){var c;c=this.$el.find("#search_student_name").val();this.search=c;return this.updateGridPage();};a.prototype.gotoAssessment=function(){var c;
c=this.$el.find("#current_part").val();if(c===""){return;}this.currentPart=parseInt(c);console.log(this.$el.find("#current_part").val());return this.updateGridPage();
};a.prototype.update=function(){this.render();return Tangerine.router.navigate("class/"+this.options.klass.id+"/"+this.currentPart);};a.prototype.back=function(){return Tangerine.router.navigate("class",true);
};a.prototype.gotoStudentSubtest=function(e){var c,d;c=$(e.target).attr("data-studentId");d=$(e.target).attr("data-subtestId");return Tangerine.router.navigate("class/result/student/subtest/"+c+"/"+d,true);
};a.prototype.nextPart=function(){if(this.currentPart<this.subtestsByPart.length-1){this.currentPart++;return this.update();}};a.prototype.prevPart=function(){if(this.currentPart>1){this.currentPart--;
return this.update();}};a.prototype.initialize=function(e){var d,c;this.search="";this.currentPart=e.part||1;this.subtestsByPart=[];c=1;while((d=e.subtests.where({part:c})).length!==0){if(d!==0){this.subtestsByPart[c]=d;
}this.subtestsByPart[c].sort(function(g,f){return g.get("name").toLowerCase()>f.get("name").toLowerCase();});c++;}return this.totalParts=c-1;};a.prototype.updateGridPage=function(){return this.$el.find("#grid_container").html(this.getGridPage());
};a.prototype.getGridPage=function(){var f,m,h,w,v,s,p,u,r,n,C,x,o,q,k,g,e,d,A,D,B,z,y,c,l;x=[];C=this.subtestsByPart[this.currentPart];l=this.options.students.models;
for(w=k=0,A=l.length;k<A;w=++k){u=l[w];x[w]=[];s=new KlassResults(this.options.results.where({studentId:u.id}));for(v=g=0,D=C.length;g<D;v=++g){n=C[v];
r=s.where({subtestId:n.id});o=r.length!==0;if(~u.get("name").toLowerCase().indexOf(this.search.toLowerCase())||this.search===""){x[w].push({content:o?"&#x2714;":"?",taken:o,studentId:u.id,studentName:u.get("name"),subtestId:n.id});
}}}h="<table class='info_box_wide'><tbody><tr><th></th>";for(e=0,B=C.length;e<B;e++){n=C[e];h+="<th><div class='part_subtest_report' data-id='"+n.id+"'>"+(n.get("name"))+"</div></th>";
}h+="</tr>";for(d=0,z=x.length;d<z;d++){p=x[d];if((p!=null)&&p.length){h+="<tr><td><div class='student' data-studentId='"+p[0].studentId+"'>"+p[0].studentName+"</div></td>";
for(m=c=0,y=p.length;c<y;m=++c){f=p[m];q=f.taken?" subtest_taken":"";h+="<td><div class='student_subtest command "+q+"' data-taken='"+f.taken+"' data-studentId='"+f.studentId+"' data-subtestId='"+f.subtestId+"'>"+f.content+"</div></td>";
}h+="</tr>";}}h+="</tbody></table>";return h;};a.prototype.render=function(){var c;c=this.getGridPage();this.$el.html("      <h1>"+(t("assessment status"))+"</h1>      <input id='search_student_name' placeholder='"+(t("search student name"))+"' type='text'>      <div id='grid_container'>"+c+"</div><br>      <h2>"+(t("current assessment"))+" </h2>            <button class='prev_part command'>&lt;</button> <input type='number' value='"+this.currentPart+"' id='current_part'> <button class='next_part command'>&gt;</button><br><br>      <button class='back navigation'>"+(t("back"))+"</button>       ");
return this.trigger("rendered");};return a;})(Backbone.View);