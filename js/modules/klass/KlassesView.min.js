var KlassesView,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];
}}function c(){this.constructor=d;}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};KlassesView=(function(a){__extends(b,a);
function b(){this.render=__bind(this.render,this);this.onSubviewRendered=__bind(this.onSubviewRendered,this);_ref=b.__super__.constructor.apply(this,arguments);
return _ref;}b.prototype.events={"click .add":"toggleAddForm","click .cancel":"toggleAddForm","click .save":"saveNewKlass","click .goto_class":"gotoKlass","click .curricula":"gotoCurricula"};
b.prototype.initialize=function(c){this.views=[];this.klasses=c.klasses;this.curricula=c.curricula;return this.klasses.on("add remove change",this.render);
};b.prototype.gotoCurricula=function(){return Tangerine.router.navigate("curricula",true);};b.prototype.saveNewKlass=function(){var c;c=[];if($.trim(this.$el.find("#year").val())===""){c.push(" - No year.");
}if($.trim(this.$el.find("#grade").val())===""){c.push(" - No grade.");}if($.trim(this.$el.find("#stream").val())===""){c.push(" - No stream.");}if(this.$el.find("#curriculum option:selected").val()==="_none"){c.push(" - No curriculum selected.");
}if(c.length===0){return this.klasses.create({year:this.$el.find("#year").val(),grade:this.$el.find("#grade").val(),stream:this.$el.find("#stream").val(),curriculumId:this.$el.find("#curriculum option:selected").attr("data-id"),startDate:(new Date()).getTime()});
}else{return alert("Please correct the following errors:\n\n"+(c.join("\n")));}};b.prototype.gotoKlass=function(c){return Tangerine.router.navigate("class/edit/"+$(c.target).attr("data-id"));
};b.prototype.toggleAddForm=function(){this.$el.find("#add_form, .add").toggle();this.$el.find("#year").focus();if(this.$el.find("#add_form").is(":visible")){return this.$el.find("#add_form").scrollTo();
}};b.prototype.renderKlasses=function(){var g,d,f,h,e,c;this.closeViews();g=$("<ul>").addClass("klass_list");c=this.klasses.models;for(h=0,e=c.length;h<e;
h++){d=c[h];f=new KlassListElementView({klass:d,curricula:this.curricula});f.on("rendered",this.onSubviewRendered);f.render();this.views.push(f);g.append(f.el);
}return this.$el.find("#klass_list_wrapper").append(g);};b.prototype.onSubviewRendered=function(){return this.trigger("subRendered");};b.prototype.render=function(){var f,e,g,d,c;
e="<option value='_none' disabled='disabled' selected='selected'>"+(t("select a curriculum"))+"</option>";c=this.curricula.models;for(g=0,d=c.length;g<d;
g++){f=c[g];e+="<option data-id='"+f.id+"'>"+(f.get("name"))+"</option>";}this.$el.html("      <h1>"+(t("classes"))+"</h1>      <div id='klass_list_wrapper'></div>      <button class='add command'>"+(t("add"))+"</button>      <div id='add_form' class='confirmation'>        <div class='menu_box'>           <div class='label_value'>            <label for='year'>"+(t("year"))+"</label>            <input id='year'>          </div>          <div class='label_value'>            <label for='grade'>"+(t("grade"))+"</label>            <input id='grade'>          </div>          <div class='label_value'>            <label for='stream'>"+(t("stream"))+"</label>            <input id='stream'>          </div>          <div class='label_value'>            <label for='curriculum'>"+(t("curriculum"))+"</label><br>            <select id='curriculum'>"+e+"</select>          </div>          <button class='command save'>"+(t("save"))+"</button><button class='command cancel'>"+(t("cancel"))+"</button>        </div>      </div>      <button class='command curricula'>"+(t("all curricula"))+"</button>    ");
this.renderKlasses();return this.trigger("rendered");};b.prototype.closeViews=function(){var e,f,d,c;c=this.views!=null;for(f=0,d=c.length;f<d;f++){e=c[f];
e.close();}return this.views=[];};b.prototype.onClose=function(){return this.closeViews();};return b;})(Backbone.View);