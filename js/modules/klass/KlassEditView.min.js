var KlassEditView,_ref,__bind=function(a,b){return function(){return a.apply(b,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];
}}function c(){this.constructor=d;}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};KlassEditView=(function(b){__extends(a,b);
function a(){this.renderStudents=__bind(this.renderStudents,this);this.onSubviewRendered=__bind(this.onSubviewRendered,this);this.registerStudent=__bind(this.registerStudent,this);
_ref=a.__super__.constructor.apply(this,arguments);return _ref;}a.prototype.events={"click .back":"back","click .save":"basicInfoSave","click .basic_info_edit":"basicInfoToggle","click .basic_info_cancel":"basicInfoToggle","click .add_student":"addStudentToggle","click .add_student_cancel":"addStudentToggle","click .add_student_add":"addStudent","click .register_student":"registerStudentToggle","click .register_student_cancel":"registerStudentToggle","click .register_student_save":"registerStudent"};
a.prototype.addStudentToggle=function(){return this.$el.find(".add_student_form, .add_student").toggle();};a.prototype.registerStudentToggle=function(){this.$el.find(".register_student_form, .register_student").toggle();
if(this.$el.find(".register_student_form").is(":visible")){this.$el.find(".register_student_form").scrollTo();}return this.$el.find("#register_student_name ,#register_student_gender, #register_student_age").val("");
};a.prototype.addStudent=function(){var c,d;if(this.$el.find("#add_student_select option:selected").val()==="_none"){return alert("Please select a student, or cancel.");
}else{d=this.$el.find("#add_student_select option:selected").attr("data-id");c=this.allStudents.get(d);c.set({klassId:this.klass.id});c.save();this.students.add(c);
return this.addStudentToggle();}};a.prototype.registerStudent=function(){this.students.create({name:this.$el.find("#register_student_name").val(),gender:this.$el.find("#register_student_gender").val(),age:this.$el.find("#register_student_age").val(),klassId:this.klass.id},{wait:true});
this.registerStudentToggle();return this.$el.find("#register_student_form input").val();};a.prototype.basicInfoToggle=function(){var c;this.$el.find(".basic_info").toggle();
c=$(this.$el.find(".basic_info")[1]);if(c.is(":visible")){c.scrollTo();this.$el.find("#year").focus();}this.$el.find("#year").val(this.klass.get("year")||"");
this.$el.find("#grade").val(this.klass.get("grade")||"");return this.$el.find("#stream").val(this.klass.get("stream")||"");};a.prototype.basicInfoSave=function(){var d,c;
d=this.$el.find("#start_date").val().split("/");c=new Date();c.setFullYear(parseInt(d[0]));c.setMonth(parseInt(d[1])-1);c.setDate(parseInt(d[2]));this.klass.set({year:this.$el.find("#year").val(),grade:this.$el.find("#grade").val(),stream:this.$el.find("#stream").val(),startDate:c.getTime()});
this.klass.save();return this.render();};a.prototype.back=function(){return window.history.back();};a.prototype.initialize=function(c){this.klass=c.klass;
this.students=c.students;this.allStudents=c.allStudents;this.students.on("add remove change",this.renderStudents);return this.views=[];};a.prototype.closeViews=function(){var e,f,d,c;
c=this.views;for(f=0,d=c.length;f<d;f++){e=c[f];e.close();}return this.views=[];};a.prototype.onSubviewRendered=function(){return this.trigger("subRendered");
};a.prototype.renderStudents=function(){var m,f,e,n,q,o,l,k,i,p,d,c,j,h,g;m=$("<ul>").addClass("student_list");this.closeViews();j=this.students.models;
for(l=0,p=j.length;l<p;l++){n=j[l];o=new StudentListElementView({student:n,students:this.students});this.views.push(o);o.on("rendered",this.onSubviewRendered);
o.render();o.on("change",this.renderStudents);m.append(o.el);}this.$el.find("#student_list_wrapper").html(m);q="<option value='_none' disabled='disabled' selected='selected'>("+($.t("name"))+") - ("+($.t("age"))+")</option>";
h=this.allStudents.models;for(k=0,d=h.length;k<d;k++){n=h[k];f=false;g=this.students.models;for(i=0,c=g.length;i<c;i++){e=g[i];if(e.id===n.id){f=true;}}if(!f){q+="<option data-id='"+n.id+"'>"+(n.get("name"))+" - "+(n.get("age"))+"</option>";
}}return this.$el.find("#add_student_select").html(q);};a.prototype.render=function(){var e,c,f,d;d=this.klass.get("year")||"";e=this.klass.get("grade")||"";
f=this.klass.get("stream")||"";c=new Date(parseInt(this.klass.get("startDate")));this.$el.html("    <button class='back navigation'>"+(t("back"))+"</button>    <h1>"+(t("class editor"))+"</h1>    <h2>"+(t("basic info"))+"</h2>    <table class='info_box basic_info'>      <tr><td><label>"+(t("year"))+"</label></td><td>"+d+"</td></tr>      <tr><td><label>"+(t("grade"))+"</label></td><td>"+e+"</td></tr>      <tr><td><label>"+(t("stream"))+"</label></td><td>"+f+"</td></tr>      <tr><td><label>"+(t("starting date"))+"</label></td><td>"+(c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate())+"</td></tr>      <tr><td colspan='2'><button class='basic_info_edit command'>"+(t("edit"))+"</button></td></tr>    </table>    <div class='basic_info confirmation'>      <div class='menu_box'>        <div class='label_value'>          <label for='year'>"+(t("year"))+"</label>          <input id='year' value='"+d+"'>        </div>        <div class='label_value'>          <label for='grade'>"+(t("grade"))+"</label>          <input id='grade' value='"+e+"'>        </div>        <div class='label_value'>          <label for='stream'>"+(t("stream"))+"</label>          <input id='stream' value='"+f+"'>        </div>        <div class='label_value'>          <label for='start_date'>"+(t("starting date"))+"</label>          <input id='start_date' value='"+(c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate())+"'>        </div>              <button class='save command'>"+(t("save"))+"</button> <button class='basic_info_cancel command'>"+(t("cancel"))+"</button>      </div>    </div>        <h2>"+(t("students").capitalize())+"</h2>    <div id='student_list_wrapper'></div>    <button class='add_student command'>"+(t("add student"))+"</button>    <div class='add_student_form menu_box confirmation'>      <div class='label_value'>        <label for='add_student_select'>"+(t("add student"))+"</label><br>        <select id='add_student_select'>        </select>      </div>            <button class='add_student_add command'>"+(t("add"))+"</button><button class='add_student_cancel command'>"+(t("cancel"))+"</button>    </div>    <button class='register_student command'>"+($.t("register student"))+"</button>    <div class='register_student_form menu_box confirmation'>      <h2>"+(t("register student"))+"</h2>      <div class='label_value'>        <label for='register_student_name'>"+(t("name"))+"</label>        <input id='register_student_name' value=''>      </div>      <div class='label_value'>        <label for='register_student_gender'>"+(t("gender"))+"</label>        <input id='register_student_gender' value=''>      </div>      <div class='label_value'>        <label for='register_student_age'>"+(t("age"))+"</label>        <input id='register_student_age' value=''>      </div>      <button class='register_student_save command'>"+(t("save"))+"</button>      <button class='register_student_cancel command'>"+(t("cancel"))+"</button>    </div>    ");
this.trigger("rendered");return this.renderStudents();};return a;})(Backbone.View);