var CurriculumImportView,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};CurriculumImportView=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.events={"click .import":"import","click .back":"back"};a.prototype.back=function(){Tangerine.router.navigate("",true);return false;
};a.prototype["import"]=function(){var e,d,c,f=this;e=this.$el.find("#d_key").val();this.$el.find(".status").fadeIn(250);this.$el.find("#progress").html("Looking for "+e);
c={filter:Tangerine.config.address.designDoc+"/importFilter",create_target:true,query_params:{downloadKey:e}};d={success:function(h,g){f.$el.find("#progress").html("Import successful <h3>Imported</h3>");
return $.couch.db("tangerine").view(Tangerine.config.address.designDoc+"/byDKey",{keys:[e],success:function(m){var p,k,n,o,l,j,i;console.log(m);o=0;p="";
i=m.rows;for(l=0,j=i.length;l<j;l++){k=i[l];n=k.value;if(n.collection==="subtest"){o++;}if(n.collection==="curriculum"){p=n.name;}}return f.$el.find("#progress").append("              <div>"+assessmentName+"</div>              <div>Subtests - "+o+"</div>            ");
},error:function(j,i,k){return this.$el.find("#progress").html("<div>Error after data imported</div><div>"+j+"</div><div>"+i);}});},error:function(h,g){return f.$el.find("#progress").html("<div>Import error</div><div>"+h+"</div><div>"+g);
}};$.couch.replicate(Tangerine.config.address.cloud.host+":"+Tangerine.config.address.port+"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,d,c);
return false;};a.prototype.render=function(){this.$el.html("    <button class='back navigation'>Back</button>    <h1>Import Curriculum</h1>    <div class='question'>      <label for='d_key'>Download key</label>      <input id='d_key' value=''>      <button class='import command'>Import</button>    </div>    <div class='confirmation status'>      <h2>Status<h2>      <div class='info_box' id='progress'></div>    </div>    ");
return this.trigger("rendered");};return a;})(Backbone.View);