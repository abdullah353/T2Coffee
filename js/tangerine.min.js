var Router,_ref,__hasProp={}.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a];}}function c(){this.constructor=d;
}c.prototype=b.prototype;d.prototype=new c();d.__super__=b.prototype;return d;};Router=(function(b){__extends(a,b);function a(){_ref=a.__super__.constructor.apply(this,arguments);
return _ref;}a.prototype.routes={login:"login",register:"register",logout:"logout",account:"account",transfer:"transfer","class":"klass","class/edit/:id":"klassEdit","class/student/:studentId":"studentEdit","class/student/report/:studentId":"studentReport","class/:id/:part":"klassPartly","class/:id":"klassPartly","class/run/:studentId/:subtestId":"runSubtest","class/result/student/subtest/:studentId/:subtestId":"studentSubtest",curricula:"curricula","curriculum/:id":"curriculum","curriculum/import":"curriculumImport",settings:"settings",update:"update","":"landing",groups:"groups",assessments:"assessments","assessments/:group":"assessments","run/:id":"run","chart/:id":"chart","print/:id":"print","resume/:assessmentId/:resultId":"resume","restart/:id":"restart","edit/:id":"edit","csv/:id":"csv","results/:name":"results","import":"import","subtest/:id":"editSubtest","question/:id":"editQuestion","report/partByStudent/:subtestId":"partByStudent","report/studentToDate/:studentId":"studentToDate","report/masteryCheck/:studentId":"masteryCheck","report/progress/:studentId":"progressReport","report/classToDate/:klassId":"klassToDate"};
a.prototype.landing=function(){if(Tangerine.settings.context==="server"){return Tangerine.router.navigate("groups",true);}else{if(Tangerine.settings.context==="mobile"){return Tangerine.router.navigate("assessments",true);
}else{if(Tangerine.settings.context==="class"){return Tangerine.router.navigate("class",true);}}}};a.prototype.groups=function(){return Tangerine.user.verify({isAdmin:function(){var c,d;
c=Tangerine.user.get("groups");if(c.length===1&&window.location.hash===""){return Tangerine.router.navigate("assessments/"+c[0],true);}else{d=new GroupsView;
return vm.show(d);}},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.curricula=function(){return Tangerine.user.verify({isRegistered:function(){var c;
c=new Curricula;return c.fetch({success:function(e){var d;d=new CurriculaView({curricula:e});return vm.show(d);}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);
}});};a.prototype.curriculum=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Curriculum({_id:c});return d.fetch({success:function(){var e;
e=new Subtests;return e.fetch({success:function(){var f,i,h,j,g;j=e.where({curriculumId:c});f=(function(){var m,l,k;k=[];for(m=0,l=j.length;m<l;m++){h=j[m];
k.push(h.get("part"));}return k;})();i=Math.max.apply(Math,f);g=new CurriculumView({curriculum:d,subtests:j,parts:i});return vm.show(g);}});}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);
}});};a.prototype.curriculumImport=function(){return Tangerine.user.verify({isRegistered:function(){var c;c=new CurriculumImportView;return vm.show(c);
},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.klass=function(){return Tangerine.user.verify({isRegistered:function(){var c;
c=new Klasses;return c.fetch({success:function(d){var e;e=new Curricula;return e.fetch({success:function(g){var f;f=new KlassesView({klasses:d,curricula:g});
return vm.show(f);}});}});}});};a.prototype.klassEdit=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Klass({_id:c});return d.fetch({success:function(e){var f;
f=new Students;return f.fetch({success:function(h){var i,g;i=new Students(h.where({klassId:c}));g=new KlassEditView({klass:e,students:i,allStudents:h});
return vm.show(g);}});}});},isUnregistered:function(){return Tangerine.router.navigate("",true);}});};a.prototype.klassPartly=function(d,c){if(c==null){c=null;
}return Tangerine.user.verify({isRegistered:function(){var e;e=new Klass({_id:d});return e.fetch({success:function(){var f;f=new Curriculum({_id:e.get("curriculumId")});
return f.fetch({success:function(){var g;g=new Students;return g.fetch({success:function(i){var h,j;j=new Students(i.where({klassId:d}));h=new KlassResults;
return h.fetch({success:function(m){var l,k;k=new KlassResults(m.where({klassId:d}));l=new Subtests;return l.fetch({success:function(o){var p,n;p=new Subtests(o.where({curriculumId:e.get("curriculumId")}));
n=new KlassPartlyView({part:c,subtests:p,results:k,students:j,curriculum:f,klass:e});return vm.show(n);}});}});}});}});}});},isUnregistered:function(e){return Tangerine.router.navigate("login",true);
}});};a.prototype.studentSubtest=function(c,d){return Tangerine.user.verify({isRegistered:function(){var e;e=new Student({_id:c});return e.fetch({success:function(){var f;
f=new Subtest({_id:d});return f.fetch({success:function(){var g;g=new Results;return g.fetch({success:function(j){var h,i;h=j.where({subtestId:d,studentId:c,klassId:e.get("klassId")});
i=new KlassSubtestResultView({result:h,subtest:f,student:e});return vm.show(i);}});}});}});}});};a.prototype.runSubtest=function(c,d){return Tangerine.user.verify({isRegistered:function(){var e;
e=new Subtest({_id:d});return e.fetch({success:function(){var f;f=new Student({_id:c});return f.fetch({success:function(){var g;g=new KlassSubtestRunView({student:f,subtest:e});
return vm.show(g);}});}});}});};a.prototype.register=function(){return Tangerine.user.verify({isUnregistered:function(){var c;c=new RegisterTeacherView({user:new User});
return vm.show(c);},isRegistered:function(){return Tangerine.router.navigate("",true);}});};a.prototype.studentEdit=function(c){return Tangerine.user.verify({isRegistered:function(){var d;
d=new Student({_id:c});return d.fetch({success:function(f){var e;e=new Klasses;return e.fetch({success:function(g){var h;h=new StudentEditView({student:f,klasses:g});
return vm.show(h);}});}});},isUnregistered:function(){return Tangerine.router.navigate("",true);}});};a.prototype["import"]=function(){return Tangerine.user.verify({isRegistered:function(){var c;
c=new AssessmentImportView;return vm.show(c);},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.assessments=function(c){if(c==null){c=null;
}if(c===null&&Tangerine.settings.context==="server"){return Tangerine.router.navigate("groups",true);}else{c=decodeURIComponent(c);return Tangerine.user.verify({isRegistered:function(){var d;
d=new Curricula;return d.fetch({success:function(f){var e;d=new Curricula(f.where({group:c}));e=new AssessmentListView({curricula:d,group:c});return vm.show(e);
}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});}};a.prototype.editId=function(c){c=Utils.cleanURL(c);return Tangerine.user.verify({isAdmin:function(){var d;
d=new Assessment({_id:c});return d.superFetch({success:function(f){var e;e=new AssessmentEditView({model:f});return vm.show(e);}});},isUser:function(){return Tangerine.router.navigate("",true);
},isUnregistered:function(d){return Tangerine.router.navigate("login",true);}});};a.prototype.edit=function(c){return Tangerine.user.verify({isAdmin:function(){var d;
d=new Assessment({_id:c});return d.fetch({success:function(f){var e;e=new AssessmentEditView({model:f});return vm.show(e);}});},isUser:function(){return Tangerine.router.navigate("",true);
},isUnregistered:function(d){return Tangerine.router.navigate("login",true);}});};a.prototype.restart=function(c){return Tangerine.router.navigate("run/"+c,true);
};a.prototype.run=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Assessment({_id:c});return d.fetch({success:function(f){var e;
e=new AssessmentRunView({model:f});return vm.show(e);}});},isUnregistered:function(d){return Tangerine.router.navigate("login",true);}});};a.prototype.chart=function(c){return Tangerine.user.verify({isRegistered:function(){var g,f,d,e;
$("#content").slideUp();g=Backbone.Collection.extend();f=new g();d=new Results();e=0;return Tangerine.$db.view('tangerine/questionsCountByAssessmentId?key="'+c+'"',{success:function(h){e=h.rows[0].value;
return d.fetch({key:c,success:function(j){var k,i;$("#graph").slideDown();i={};j.each(function(m,l){return i[l]=m.get("subtestData");});_.each(i,function(m,p){var o,q,l,n;
n="";o=0;l=0;if(_.last(m).prototype==="complete"){_.each(m,function(s){var r;if(s.prototype==="location"){n=s.data.location.join();}if(s.prototype==="survey"){r=s.data;
if(r[Object.keys(r)[0]]==="1"){return o++;}else{return l++;}}});q=true;f.each(function(r){if(r.get("state")===n){return q=false;}});if(q){return f.add({state:n,correct:Number(((o/e)*100).toFixed(2))});
}}});k=f.toJSON();return $("#chartContainer").dxChart({dataSource:k,commonSeriesSettings:{argumentField:"state",type:"bar",hoverMode:"allArgumentPoints",selectionMode:"allArgumentPoints",label:{visible:true,precision:0}},valueAxis:{title:"Percentages Result"},series:[{valueField:"correct",name:"correct"}],title:"Percentage Result Report",legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},pointClick:function(l){return this.select();
},commonAxisSettings:{label:{font:{color:"black",size:15},overlappingBehavior:{mode:"rotate",rotationAngle:80}}}});}});}});},isUnregistered:function(d){return Tangerine.router.navigate("login",true);
}});};a.prototype.print=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Assessment({_id:c});return d.fetch({success:function(f){var e;
e=new AssessmentPrintView({model:f});return vm.show(e);}});},isUnregistered:function(d){return Tangerine.router.navigate("login",true);}});};a.prototype.resume=function(d,c){return Tangerine.user.verify({isRegistered:function(){var e;
e=new Assessment({_id:d});return e.fetch({success:function(g){var f;f=new Result({_id:c});return f.fetch({success:function(h){var i;i=new AssessmentRunView({model:g});
i.result=h;i.subtestViews.pop();i.subtestViews.push(new ResultView({model:h,assessment:g,assessmentView:i}));i.index=h.get("subtestData").length;return vm.show(i);
}});}});},isUnregistered:function(e){return Tangerine.router.navigate("login",true);}});};a.prototype.results=function(c){return Tangerine.user.verify({isRegistered:function(){var d;
d=new Assessment({_id:c});return d.fetch({success:function(){var e,f=this;e=new Results;return e.fetch({key:c,success:function(){var g;g=new ResultsView({assessment:d,results:e.models});
return vm.show(g);}});}});},isUnregistered:function(d){return Tangerine.router.navigate("login",true);}});};a.prototype.csv=function(c){return Tangerine.user.verify({isAdmin:function(){var d;
d=new CSVView({assessmentId:c});return vm.show(d);},isUser:function(){var d;d=new ErrorView({message:"You're not an admin user",details:"How did you get here?"});
return vm.show(d);}});};a.prototype.partByStudent=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Subtest({_id:c});return d.fetch({success:function(){var e;
e=new Results;return e.fetch({success:function(g){var f,h;f=g.where({subtestId:d.id});h=new Students;return h.fetch({success:function(){var i;i=new PartByStudentView({students:h,subtest:d,results:f});
return vm.show(i);}});}});}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.klassToDate=function(c){return Tangerine.user.verify({isRegistered:function(){var d;
d=new Klass({_id:c});return d.fetch({success:function(){var e;e=new Students;return e.fetch({success:function(g){var h,f,i;i=g.where({klassId:c});f=i.length;
h=new Subtests;return h.fetch({success:function(k){var j,l;l=k.where({curriculumId:d.get("curriculumId")});j=new Results;return j.fetch({success:function(n){var m;
m=new KlassToDateView({studentCount:f,results:n,subtests:l,klass:d});return vm.show(m);}});}});}});}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);
}});};a.prototype.masteryCheck=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Student({_id:c});return d.fetch({success:function(f){var e;
e=new Klass({_id:f.get("klassId")});return e.fetch({success:function(h){var g;g=new Results;return g.fetch({success:function(k){var j,i;j=new Results(k.where({studentId:c,reportType:"mastery"}));
i=new MasteryCheckView({student:f,results:j,klass:h});return vm.show(i);}});}});}});}});};a.prototype.progressReport=function(c){return Tangerine.user.verify({isRegistered:function(){var d;
d=new Student({_id:c});return d.fetch({success:function(f){var e;e=new Klass({_id:f.get("klassId")});return e.fetch({success:function(h){var g;g=new Results;
return g.fetch({success:function(k){var j,i;j=new Results(k.where({studentId:c,reportType:"progress"}));i=new ProgressView({student:f,results:j,klass:h});
return vm.show(i);}});}});}});}});};a.prototype.studentToDate=function(c){return Tangerine.user.verify({isRegistered:function(){var d;d=new Student({_id:c});
return d.fetch({success:function(f){var e;e=new Klass({_id:f.get("klassId")});return e.fetch({success:function(){var g;g=new Subtests;return g.fetch({success:function(i){var h,j;
j=i.where({curriculumId:e.get("curriculumId")});h=new Results;return h.fetch({success:function(l){var k;k=new StudentToDateView({results:l,subtests:j,klass:e,studentId:c,student:f});
return vm.show(k);}});}});}});}});},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.editSubtest=function(c){return Tangerine.user.verify({isAdmin:function(){var d;
c=Utils.cleanURL(c);d=new Subtest({_id:c});return d.fetch({success:function(f,e){var g;g=new Assessment({_id:d.get("assessmentId")});return g.fetch({success:function(){var h;
h=new SubtestEditView({model:f,assessment:g});return vm.show(h);}});}});},isUser:function(){return Tangerine.router.navigate("",true);},isUnregistereded:function(){return Tangerine.router.navigate("login",true);
}});};a.prototype.editQuestion=function(c){return Tangerine.user.verify({isAdmin:function(){var d;c=Utils.cleanURL(c);d=new Question({_id:c});return d.fetch({success:function(f,e){var g;
g=new Assessment({_id:d.get("assessmentId")});return g.fetch({success:function(){var h;h=new Subtest({_id:d.get("subtestId")});return h.fetch({success:function(){var i;
i=new QuestionEditView({question:d,subtest:h,assessment:g});return vm.show(i);}});}});}});},isUser:function(){return Tangerine.router.navigate("",true);
},isUnregistered:function(){return Tangerine.router.navigate("login",true);}});};a.prototype.login=function(){return Tangerine.user.verify({isRegistered:function(){return Tangerine.router.navigate("",true);
},isUnregistered:function(){var c;c=new LoginView;return vm.show(c);}});};a.prototype.logout=function(){return Tangerine.user.logout();};a.prototype.account=function(){return Tangerine.user.verify({isRegistered:function(){var c;
c=new AccountView({user:Tangerine.user});return vm.show(c);},isUnregistered:function(c){return Tangerine.router.navigate("login",true);}});};a.prototype.settings=function(){return Tangerine.user.verify({isRegistered:function(){var c;
c=new Settings({_id:"TangerineSettings"});return c.fetch({success:function(e){var d;d=new SettingsView({settings:e});return vm.show(d);}});},isUnregistered:function(c){return Tangerine.router.navigate("login",true);
}});};a.prototype.update=function(){return Tangerine.user.verify({isAdmin:function(){$("#version-uuid").html("Updating...");return $.couch.replicate(Tangerine.config.address.cloud.host+"/"+Tangerine.config.address.cloud.dbName,Tangerine.config.address.local.dbName,{success:function(){$("#version-uuid").html("Successful update, now refreshing app...");
return _.delay(function(){Tangerine.router.navigate("",false);return document.location.reload();},2000);},error:function(c){return $("#version-uuid").html("Error updating: "+c);
}},{doc_ids:["_design/tangerine"]});},isUnregistered:function(c){return Tangerine.router.navigate("login",true);}});};a.prototype.logs=function(){var c;
c=new LogView;return vm.show(c);};a.prototype.transfer=function(){var c,d,e=this;c=Utils.$_GET();d=c.name;return $.couch.logout({success:function(){$.cookie("AuthSession",null);
return $.couch.login({name:d,password:d,success:function(){Tangerine.router.navigate("");return window.location.reload();},error:function(){return $.couch.signup({name:d,roles:["_admin"]},d,{success:function(){var f;
f=new User;return f.save({name:d,id:"tangerine.user:"+d,roles:[],from:"tc"},{wait:true,success:function(){return $.couch.login({name:d,password:d,success:function(){Tangerine.router.navigate("");
return window.location.reload();},error:function(){var g;g=new ErrorView({message:"There was a username collision",details:""});return vm.show(g);}});}});
}});}});}});};return a;})(Backbone.Router);$(function(){window.vm=new ViewManager();Tangerine.router=new Router();Tangerine.user=new User();Tangerine.nav=new NavigationView({user:Tangerine.user,router:Tangerine.router});
return Tangerine.user.fetch({success:function(){return Backbone.history.start();},error:function(){return Backbone.history.start();}});});